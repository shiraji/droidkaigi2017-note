DDD (How to apply DDD to Android Application Development)

実践ドメイン駆動開発本はエリックえばんすの本を前提に書いてあるから気をつけて。

ドメイン駆動設計

# ドメインとは？
  ユーザがプログラムを適用する対象領域
  - 料理アプリの場合、「料理のレシピを検索する。」＝ドメイン「料理」「レシピ」
  - Uber？ -> 近距離移動
   - 自分のアプリに関しても考えてみる。
  - githubの場合、SWという「概念的なもの」も入ってくる。

# ドメイン駆動
  - ドメインエキスパート -> ドメインに詳しい人。ドメインに自分より詳しい人。アプリについて詳しい人
    -> ものや関係性などの概念的なモデルがある
  - ドメインエキスパートから解釈・蒸留して、共通概念としてモデル化したものが「ドメインモデル」
  - ドメインモデルをコードで正確に表現する(コードで正確に表現すれば、それが設計書になる。ただし同じユビキタス言語を持っている人に対して)
  - ただし、最初から完璧なドメインモデルを作るのは不可能
  - ドメインモデル<->実装(アジャイル的なプロセスでドメインモデルと実装をよくしていく。最初にドメインモデルを作ってから、実装する)
  - ドメインモデルを作り上げるまでが戦略的設計(ユビキタス言語、コンテキストマップ、境界づけられたコンテキスト)
  - ドメインモデルを昇華するのが戦術的設計(値オブジェクト、エンティティ、サービス)

## ユビキタス言語
  - ドメインを表す単語
  - ドメイン駆動ではいつでも同じユビキタス元号を使う。
  - 何がユビキタス言語かをチームで合意をとって決める

# よくある勘違い

* DDD != Clean Architecture
 * Clean ArchitectureはDDDに影響受けているが、イコールではない。
* DDD != MVW(そもそもView出てない)
* レイヤ化アーキ != DDD

# Android開発＋DDD

* 境界づけられたコンテキスト
* Accountという言葉、ユーザに関してであれば、アカウント。銀行であれば口座など、コンテキストが違えば言葉の意味が違ってくる
* 言葉の境涯がコンテキストの協会
 * チームが異なると言葉が乖離していく。
 * 機能・コードベースもコンテキストの教会になる。
 
## Android開発

### パートナーシップ

アプリ<->ライブラリ
アプリ<->社内の機能のSDK
アプリ<->3rdパーティ(順応者)

### 腐敗防止層

ドメインモデルを汚染しないように、JSONなどをパースして、ドメインモデルに変換するそうが必要になる。

ドメイン層を隔離できさえすれば、どんなアーキでも問題ない。

### UI

アプリはUIでドメインモデルが汚染されやすい。

とりあえずーということになると、利口なUI(=処理がいっぱいの)となってしまいガチ。

画面デザイン駆動設計問題

### おまけ

float weiget = animal.weiget();
if (weight != -1) { // マイナス？Viewがロジックをしっている。
    textView.setText(weight + "kg");
}

Weightオブジェクトとして表示。

---

サーバから”M"/"F"がくるような場合、腐敗槽でEnumとして変換し、そのEnumを使って出し分けする。
Viewにif ("M".equels(sex)) { textView.setText("オス"); }のように利口なViewを作成しない。

### Q&A

Q ユビキタス言語。現実のコードでは日本語、プログラミングでは英語？どうハンドリングする？

A 対応表とか作るのが良いのではないか？

-

Q バリデーションチェック？はどの層にあたる？

A 実際よく悩む。Viewなのか？ドメインなのか？粒度が違う。UIであれば補助。ドメインであればドメインモデルやデータとして存在出来ない場合はドメイン層。例えば空文字であればUI。ビジネス的に必ず満たしていなければならないのはドメイン層。空文字もドメインっぽいけど・・・？


